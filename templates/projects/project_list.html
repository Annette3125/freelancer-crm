{% extends "base.html" %}

{% load static %}

{% block title %}Projects{% endblock %}

{% block content %}

    <h1>Projects</h1>

<p>
    <a href="{% url 'project_create' %}">+ New project</a>
</p>


    <p>
        Total: {{ total_filtered }} of {{ total_all }} project{% if total_filtered != 1 %}s{% endif %}
    </p>

    <form method="get">
        <label for="status-filter"><strong>Status filter:</strong></label>
        <select name="status" id="status-filter">
            <option value="">All statuses</option>
            {% for value, label in status_choices %}
                <option value="{{ value }}"{% if value == status %} selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
        <button type="submit">Apply</button>
    </form>

    <hr>

<p>
    <label for="project-search"><strong>Search projects:</strong></label>
    <input
        type="text"
        id="project-search"
        placeholder="Type to filter by title or client..."
    >
</p>


    {% if projects %}
        <div class="summary-toggle">
            <label>
                <input type="checkbox" id="toggle-summaries" checked>
                Show AI summaries
            </label>
        </div>
    {% endif %}

    <hr>


    <table id="projects-table" border="1">
        <tr>
            <th>Title</th>
            <th>Client</th>
            <th>Status</th>
            <th>Budget</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
        {% for project in projects %}
        <tr>

            <td>
                {{ project.title }}<br>
                {% if project.summary %}
                    <div class="project-summary-block">
                        <span class="project-summary-label">AI summary:</span>
                        <span class="project-summary">{{ project.summary }}</span>
                    </div>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'client_detail' project.client.pk %}">
                    {{ project.client.name }}
                </a>
            </td>


            <td>
    {% if project.status == "lead" %}
        <span class="status-badge status-lead">{{ project.get_status_display }}</span>
    {% elif project.status == "planned" %}
        <span class="status-badge status-lead">{{ project.get_status_display }}</span>
    {% elif project.status == "in_progress" %}
        <span class="status-badge status-active">{{ project.get_status_display }}</span>
    {% elif project.status == "paused" %}
        <span class="status-badge status-paused">{{ project.get_status_display }}</span>
    {% elif project.status == "completed" %}
        <span class="status-badge status-completed">{{ project.get_status_display }}</span>
    {% else %}
        {{ project.get_status_display }}
    {% endif %}
</td>

            <td>
                {% if project.budget %}
                    {{ project.budget }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ project.created_at|date:"Y-m-d" }}</td>

         <td>
            <a href="{% url 'project_update' project.pk %}">✏️ Edit</a>
        </td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No projects yet.</td>
        </tr>
        {% endfor %}
    </table>

    <p><a href="{% url 'client_list' %}">← Back to clients</a></p>
{% endblock %}


{% block extra_js %}
    <script src="{% static 'js/project_filters.js' %}"></script>


{% endblock %}